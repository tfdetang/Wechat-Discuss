{% extends "mobile_header.html" %}

{% block body %}
    <style type="text/css">

        .avatar {
            width: 1.3rem;
        }

        .time {
            color: darkgray;
            font-size: 0.6rem;
        }

        .card {
            margin-left: 0;
            margin-right: 0;
            width: auto;
        }

        .content-block {
            margin-top: 0.8rem;
        }

        .footer {
            font-size: 0.8rem;
        }

        .footer a {
            color: darkgray;
        }

    </style>

    <!-- page集合的容器，里面放多个平行的.page，其他.page作为内联页面由路由控制展示 -->
    <div class="page-group">
        <!-- 单个page ,第一个.page默认被展示-->
        <div class="page" id="home">
            <!-- 标题栏 -->
            <header class="bar bar-nav" id="head-nav">
                <a class="icon pull-left open-panel"><img class="avatar"
                                                          src="http://{{ baseurl }}/avatar_{{ g.user.id }}"/></a>
                <a class="icon icon-search pull-right" href="#search"></a>
                <h2 class="title">主页</h2>

            </header>

            <!-- 这里是页面内容区 -->
            <div class="content">
                <div class="content-block" id="card_list">


                </div>
            </div>
        </div>

        <!-- 其他的单个page内联页（如果有） -->
        <div class="page" id="search">
            <header class="bar bar-nav">
                <a class="icon icon-left pull-left" href="#home"></a>
                <h2 class="title">搜索</h2>
            </header>
            <div class="bar bar-header-secondary">
                <div class="searchbar">
                    <a class="searchbar-cancel">取消</a>
                    <div class="search-input">
                        <label class="icon icon-search" for="search"></label>
                        <input type="search" id='search' placeholder='输入关键字...'/>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- popup, panel 等放在这里 -->
    <div class="panel-overlay"></div>
    <!-- Left Panel with Reveal effect -->
    <div class="panel panel-left panel-reveal">
        <div class="content-block">
            <a class="tab-item external active" href="#">
                <i class="fa fa-home" aria-hidden="true"></i>
                <span class="tab-label">主页</span>
            </a>
            <br/>
            <a class="tab-item external" href="#">
                <i class="fa fa-info-circle" aria-hidden="true"></i>
                <span class="tab-label">通知</span>
            </a>
            <br/>
            <a class="tab-item external" href="#">
                <i class="fa fa-envelope-open-o" aria-hidden="true"></i>
                <span class="tab-label">私信</span>
            </a>
            <br/>
            <!-- Click on link with "close-panel" class will close panel -->
            <p><a href="#" class="close-panel">关闭</a></p>
        </div>
    </div>


    <!-- 默认必须要执行$.init(),实际业务里一般不会在HTML文档里执行，通常是在业务页面代码的最后执行 -->
    <script>

        String.prototype.format = function () {
            var args = arguments;
            return this.replace(/\{(\d+)\}/g, function (a, num) {
                return args[num] || a
            })
        };

        $.getJSON('/timeline/get_followed_message/', {
            'start': '0'
        }, function (messages) {
            if (messages.num > 0) {
                $("#card_list").html("");
                for (var i = 0; i < messages.message_list.length; i++) {

                    var id = messages.message_list[i].author_id;
                    var nick_name = messages.message_list[i].nickname;
                    var create_time = moment(messages.message_list[i].time_create).fromNow();
                    var content = messages.message_list[i].body;

                    var raw = "<div class=\"card facebook-card\">\n" +
                        "    <div class=\"card-header no-border\">\n" +
                        "      <div class=\"facebook-avatar\"><img src=\"http://{{ baseurl }}/avatar_{0}\" width=\"34\" height=\"34\"></div>\n" +
                        "      <div class=\"facebook-name\">{1} <span class=\"time\">{2}</san></div>\n" +
                        "    </div>\n" +
                        "    <div class=\"card-content\">" +
                        "       <div class=\"card-content-inner\"><p>{3}</p>" +
                        "    <div class=\"footer row\">\n" +
                        "      <span class=\"col-20\"> </span>\n" +
                        "      <a href=\"#\" class=\"link col-20\"><i class=\"fa fa-heart-o\" aria-hidden=\"true\"></i></a>\n" +
                        "      <a href=\"#\" class=\"link col-20\"><i class=\"fa fa-comments-o\" aria-hidden=\"true\"></i></a>\n" +
                        "      <a href=\"#\" class=\"link col-20\"><i class=\"fa fa-retweet\" aria-hidden=\"true\"></i></a>\n" +
                        "      <a href=\"#\" class=\"link col-20\"><i class=\"fa fa-envelope-o\" aria-hidden=\"true\"></i></a>\n" +
                        "    </div>\n" +
                        "</div></div>\n" +
                        "  </div>";
                    raw = raw.format(id, nick_name, create_time, content);
                    var html = $(raw);

                    $("#card_list").append(html);
                }

            }

        });

        $.init();
    </script>

{% endblock %}
